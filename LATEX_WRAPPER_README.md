# LaTeX Compilation Wrapper

A robust LaTeX compilation wrapper that automatically detects and creates missing subvariant files before compilation, preventing "File `subvariant_N.tex' not found" errors.

## Problem Solved

When compiling LaTeX documents that use `\input{subvariant_N}` commands, compilation fails with errors like:
```
! LaTeX Error: File `subvariant_1.tex' not found.
```

This wrapper automatically creates placeholder files for missing subvariants, allowing compilation to proceed successfully.

## Features

- **Automatic Detection**: Scans LaTeX files for `\input{subvariant_N}` commands
- **Placeholder Creation**: Creates fallback subvariant files when they're missing
- **Multiple Interface Options**: Batch file, PowerShell script, and direct Python usage
- **Cleanup Options**: Automatic or manual cleanup of created placeholder files
- **Windows Optimized**: Handles Windows paths and LaTeX installations (MiKTeX, TeX Live)
- **Error Handling**: Comprehensive error reporting and troubleshooting guidance

## Files Created

1. **`latex_wrapper.py`** - Core Python wrapper script
2. **`pdflatex_wrapper.bat`** - Windows batch file wrapper
3. **`pdflatex_wrapper.ps1`** - PowerShell wrapper script

## Quick Start

### Using Batch File (Recommended for Windows)
```bash
# Basic compilation
pdflatex_wrapper.bat document.tex

# With pdflatex options
pdflatex_wrapper.bat -interaction=nonstopmode document.tex

# Keep placeholder files for inspection
pdflatex_wrapper.bat --no-cleanup document.tex

# Check what's missing without compiling
pdflatex_wrapper.bat --list-missing document.tex

# Clean up placeholder files from previous runs
pdflatex_wrapper.bat --cleanup-only document.tex
```

### Using PowerShell
```powershell
# Basic compilation
.\pdflatex_wrapper.ps1 document.tex

# With options
.\pdflatex_wrapper.ps1 -interaction=nonstopmode document.tex

# Keep placeholder files
.\pdflatex_wrapper.ps1 --no-cleanup document.tex
```

### Using Python Directly
```bash
python latex_wrapper.py document.tex
python latex_wrapper.py --list-missing document.tex
python latex_wrapper.py --no-cleanup document.tex
```

## Command Line Options

| Option | Description |
|--------|-------------|
| `--no-cleanup` | Don't remove created placeholder files after compilation |
| `--cleanup-only` | Only remove placeholder files from previous runs |
| `--list-missing` | List missing subvariant files without compiling |
| `--help` | Show detailed help information |

## How It Works

1. **Pre-processing**: The wrapper scans the target `.tex` file for `\input{subvariant_N}` commands
2. **Detection**: Identifies which subvariant files are missing
3. **Creation**: Generates placeholder files with informative content
4. **Compilation**: Runs the actual `pdflatex` compilation
5. **Cleanup**: Optionally removes created placeholder files

## Placeholder File Content

Created placeholder files contain:
```latex
% Placeholder for subvariant_N
% Auto-generated by LaTeX compilation wrapper
% This file was missing during compilation

\begin{itemize}
\item Subvariant N - Placeholder Content
\item This is a fallback subvariant generated automatically
\item Original subvariant file was not found
\end{itemize}
```

## LaTeX Installation Support

The wrapper automatically detects LaTeX installations in common Windows locations:
- MiKTeX (Program Files and Program Files x86)
- TeX Live (2024, 2023, etc.)
- Any LaTeX installation in the system PATH

## Error Handling

The wrapper provides helpful error messages for common issues:
- LaTeX not installed or not in PATH
- Missing .tex files
- Compilation errors
- Permission issues

## Integration with Existing Workflows

### Replace pdflatex calls
Instead of:
```bash
pdflatex document.tex
```

Use:
```bash
pdflatex_wrapper.bat document.tex
```

### VS Code Tasks
Update your `.vscode/tasks.json`:
```json
{
    "label": "Compile LaTeX",
    "type": "shell",
    "command": "pdflatex_wrapper.bat",
    "args": ["-interaction=nonstopmode", "${file}"],
    "group": "build"
}
```

### Makefiles
Replace pdflatex commands:
```makefile
%.pdf: %.tex
	pdflatex_wrapper.bat -interaction=nonstopmode $<
```

## Troubleshooting

### "pdflatex not found"
- Install MiKTeX or TeX Live
- Ensure LaTeX is in your system PATH
- The wrapper searches common installation locations automatically

### "Python not found"
- Install Python 3.6+ from python.org
- Add Python to your system PATH

### Compilation still fails
- Use `--list-missing` to check for missing files
- Use `--no-cleanup` to inspect generated placeholder files
- Check the actual LaTeX error messages

## Examples

### Basic Usage
```bash
# Compile a document with missing subvariants
pdflatex_wrapper.bat test_document.tex

# Output:
# Processing LaTeX file: test_document.tex
# Created placeholder: subvariant_1.tex
# Created placeholder: subvariant_2.tex
# [pdflatex compilation output...]
# Compilation completed successfully.
```

### Inspection Mode
```bash
# Check what's missing without compiling
pdflatex_wrapper.bat --list-missing test_document.tex

# Output:
# Missing 2 subvariant files:
#   - subvariant_1.tex
#   - subvariant_2.tex
```

### Keep Placeholders
```bash
# Compile but keep placeholder files for review
pdflatex_wrapper.bat --no-cleanup test_document.tex

# Output:
# Warning: 2 placeholder files were created.
# Run with --cleanup-only to remove them, or check the compilation output.
```

## Benefits

- **Zero Code Changes**: No modifications needed to existing LaTeX generation code
- **Intervention Approach**: Wraps around the compilation process
- **Backward Compatible**: Works with existing LaTeX files and workflows
- **Robust**: Handles edge cases and provides helpful error messages
- **Cross-platform**: Core Python script works on any platform

## Technical Details

- **Language**: Python 3.6+ compatible
- **Dependencies**: Only standard library modules (os, sys, re, subprocess, pathlib, argparse)
- **Platform**: Optimized for Windows, works on other platforms
- **Performance**: Minimal overhead, only processes when needed
- **Safety**: Creates identifiable placeholder files, easy to clean up

This wrapper provides a non-invasive solution to the missing subvariant files problem, allowing your existing LaTeX generation system to work without modification while preventing compilation failures.